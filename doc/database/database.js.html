<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: database.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: database.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const PouchDB = require('pouchdb');
PouchDB.plugin(require('pouchdb-find'));
const db = new PouchDB('site_de_vente');

/**
 * makeid function.
 * @param {number}  length of string.
 * @return {number} The sum of the two numbers.
 */
function makeid(length) {
  let result = '';
  const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
  const charactersLength = characters.length;
  for ( let i = 0; i &lt; length; i++ ) {
    result += characters.charAt(Math.floor(Math.random() * charactersLength));
  }
  return result;
}

/**
 * checkuserlogin function.
 * @param {object}   res .
 * @param {object}   data .
 */
function checkuserlogin(res, data) {
  db.allDocs({
    include_docs: true,
    attachments: false,
  }, function(err, response) {
    if (err) {
      return console.log(err);
    }
  }).then(function(result) {
    const array = [];
    for (let index = 0; index &lt; result.rows.length; index++) {
      array.push(result.rows[index].doc);
    }

    const finduser = [];
    let ok = false;
    for (let index = 0; index &lt; array.length; index++) {
      if ('login' in array[index]) {
        finduser.push(array[index]);
      }
    }
    let userdata = {};
    console.log('started for looking');
    for (let index = 0; index &lt; finduser.length; index++) {
      if ((finduser[index].mail==data.login) &amp;&amp; (finduser[index].password==data.password)) {
        ok=true;
        userdata = finduser[index];
        console.log('found');
      }
    }

    res.setHeader('Content-Type', 'application/json');
    if (ok) {
      res.end(JSON.stringify({reponse: 'found', data: userdata}));
    } else {
      res.end(JSON.stringify({reponse: 'not'}));
    }
  });
}

/**
 * inseruser function.
 * @param {object}   user .
 */
function inseruser(user) {
  db.put({
    _id: makeid(5),
    login: user.login,
    mail: user.mail,
    password: user.password,
  }, function(err, response) {
    if (err) {
      return console.log(err);
    }
    console.log('insert data in databse is done!!!');
  });
}

/**
 * inseruser function.
 * @param {object}   res .
 * @param {object}   data .
 */
function checkuser(res, data) {
  db.allDocs({
    include_docs: true,
    attachments: false,
  }, function(err, response) {
    if (err) {
      return console.log(err);
    }
  }).then(function(result) {
    const array = [];
    for (let index = 0; index &lt; result.rows.length; index++) {
      array.push(result.rows[index].doc);
    }

    const finduser = [];
    let ok = false;
    for (let index = 0; index &lt; array.length; index++) {
      if ('login' in array[index]) {
        finduser.push(array[index]);
      }
    }

    for (let index = 0; index &lt; finduser.length; index++) {
      if (finduser[index].login==data) {
        ok=true;
      }
    }

    res.setHeader('Content-Type', 'application/json');
    if (ok) {
      res.end(JSON.stringify({reponse: 'found'}));
    } else {
      res.end(JSON.stringify({reponse: 'not'}));
    }
  });
}

/**
 * displaydocs function.
 * @param {object}   state .
 * @param {object}   res .
 * @param {object}   page .
 */
function displaydocs(state, res, page) {
  db.allDocs({
    include_docs: true,
    attachments: false,
  }, function(err, response) {
    if (err) {
      return console.log(err);
    }
  }).then(function(result) {
    const array = [];
    for (let index = 0; index &lt; result.rows.length; index++) {
      if ('name' in result.rows[index].doc) {
        array.push(result.rows[index].doc);
      }
    }
    res.render(page, {
      account: state,
      products: array,
    });
  });
}

/**
 * displaydocs function.
 * @param {object}   page .
 * @param {object}   state .
 * @param {object}   x .
 * @param {object}   res .
 */
function findrecord(page, state, x, res) {
  db.allDocs({
    include_docs: true,
    attachments: false,
  }, function(err, response) {
    if (err) {
      return console.log(err);
    }
  }).then(function(result) {
    const array = [];
    for (let index = 0; index &lt; result.rows.length; index++) {
      array.push(result.rows[index].doc);
    }
    let find;
    for (let index = 0; index &lt; array.length; index++) {
      if (x == array[index].ref) {
        find = array[index];
      }
    }
    res.render(page, {
      data: find,
      account: state,
    });
  });
}

/**
 * displaydocs function.
 * @param {object}   user .
 * @param {object}   res .
 * @param {object}   req .
 */
function createuser(user, res, req) {
  db.put({
    _id: index.toString()+'a',
    login: 'login' + index.toString(),
    mail: 'mail' + index.toString() + '@mail.com',
    password: 'password'+index.toString(),
  }, function(err, response) {
    if (err) {
      return console.log(err);
    }
    console.log('insert user data in databse is done!!!');
  });
}

/**
 * displaydocs function.
 * @param {object}   res .
 * @param {object}   req .
 */
function insertcontact(res, req) {
  const data = {
    mail: req.query.emaildata,
    subject: req.query.subjectdata,
  };
  db.put({
    _id: makeid(10),
    emaildata: data.mail,
    subjectdata: data.subject,
  }, function(err, response) {
    if (err) {
      res.end(JSON.stringify({reponse: 'not save'}));
      return console.log(err);
    }
    res.end(JSON.stringify({reponse: 'save'}));
  });
}


/**
 * displaydocs function.
 * @param {object}   req .
 * @param {object}   res .
 */
function saveproductdb(req, res) {
  const data = {
    productname: req.query.productname,
    price: req.query.price,
  };
  db.put({
    _id: makeid(10),
    ref: makeid(10),
    name: 'Product ' + 'N' + data.productname.toString(),
    price: data.price + '$',
  }, function(err, response) {
    if (err) {
      res.end(JSON.stringify({reponse: 'not save'}));
      return console.log(err);
    }
    res.end(JSON.stringify({reponse: 'save'}));
  });
}

module.exports = {
  checkuserlogin: checkuserlogin,
  fetch: displaydocs,
  insert: inseruser,
  checkuser: checkuser,
  findrecord: findrecord,
  createuser: createuser,
  insertcontact: insertcontact,
  saveproductdb: saveproductdb,
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#checkuser">checkuser</a></li><li><a href="global.html#checkuserlogin">checkuserlogin</a></li><li><a href="global.html#createuser">createuser</a></li><li><a href="global.html#displaydocs">displaydocs</a></li><li><a href="global.html#findrecord">findrecord</a></li><li><a href="global.html#insertcontact">insertcontact</a></li><li><a href="global.html#inseruser">inseruser</a></li><li><a href="global.html#makeid">makeid</a></li><li><a href="global.html#saveproductdb">saveproductdb</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Thu Feb 27 2020 16:33:58 GMT+0100 (Central European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
